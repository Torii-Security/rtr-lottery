# Restore the Republic (RTR) Lottery

Restore the Republic (RTR) Lottery is a decentralized lottery program built on Solana. It is designed to reward active community members fairly and transparently, enhancing participation and supporting the network's decentralization.

## Purpose

The RTR Lottery aims to incentivize participation in the governance and maintenance of the network by providing a periodic opportunity for stakers to win rewards. This not only enhances community engagement but also helps in decentralizing the network further.

## Lottery Process Overview

The RTR Lottery follows a clearly defined process to ensure fairness, transparency, and verifiability:

### Step 1: Snapshot

A snapshot of all current stakers and their stakes (including not-claimed rewards) is taken at a predetermined block height and is then uploaded to the InterPlanetary File System (IPFS). Uploading the snapshot to IPFS ensures that the data cannot be altered after the fact, providing an immutable record of all participants at the time of the snapshot.

To verify the snapshot, you can run the following script:
1. Modify RPC_ENDPOINT in scripts/create_snapshot.ts
2. Run the script

```bash
npx tsx scripts/create_snapshot.ts
```

### Step 2: Lottery Creation

Once the snapshot is secured on IPFS, a lottery event is created detailing the URL to the snapshot and the id of lottery.

### Step 3: Rolling the Lottery

The Torii is responsible to invoke the `roll` instruction on the on-chain program. The program uses Switchboard Oracle to generate a secure and random outcome. This randomness is used to pick a winner based on their proportionate share of the total staked tokens. Randomness is generated by the independent Oracle provided by Switchboard. Random number generation is done on-chain and result can be known with Solana program logs.

The Torii  retrieves the snapshot from IPFS and uses random number generated in previous step to run Open Source pick winner algorithm. Then RTR governance announces the winner. Everyone can verify the winner by running the pick winner algorithm locally with the same snapshot and random number.

To run pick winner algorithm:
1. Modify RPC_ENDPOINT in scripts/get_winner.ts
2. Provide lottery id in scripts/get_winner.ts
2. Run the script

```bash
npx tsx scripts/get_winner.ts
```

### Step 4: Winner Announcement and Verification

If the winner does not contact the governance via [x.com](https://x.com) or Telegram within the specified timeframe to verify ownership of the winning address, a new roll will be conducted using the same snapshot but a different random value. This process repeats until a verified winner is declared.

Winners are announced on official channels, including Telegram and Twitter, providing the community with immediate updates.

## Verification and Transparency

Transparency and verifiability are crucial to the integrity of our lottery process. Participants and the public can verify the fairness of the lottery through the following resources:

- **Lottery Algorithm**: The algorithm used for picking the winner is open-source.
- **Lottery Program**: The lottery program is open-source.

### On-Chain Verification

All lottery events and outcomes are recorded on the blockchain. Verify the transactions and program messages related to the lottery events at the following block explorer:

- [RTR Lottery Program](https://solscan.io/account/RTR9dcRa944pvid1nNqPQgt5TwvfZDtt5o79YQFSBbM)

### Manual Verification

Anyone can ensure that the winner pick is valid by pulling the snapshot from IPFS, reviewing on-chain data from program messages, and running the open-source 'pick winner' script to verify that the governance picked the correct winner. This provides a high level of security and trust in the process.

## Conclusion

The RTR Lottery is designed to reward active community members fairly and transparently, enhancing participation and supporting the network's decentralization. By using blockchain technology, IPFS, and VRF, we provide a secure and verifiable method for community engagement.
